(()=>{var L=(n,i)=>()=>(i||n((i={exports:{}}).exports,i),i.exports);var ie=L((tt,H)=>{var V=function(n){"use strict";var i=Object.prototype,f=i.hasOwnProperty,o,c=typeof Symbol=="function"?Symbol:{},l=c.iterator||"@@iterator",h=c.asyncIterator||"@@asyncIterator",v=c.toStringTag||"@@toStringTag";function d(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{d({},"")}catch{d=function(e,r,s){return e[r]=s}}function U(t,e,r,s){var a=e&&e.prototype instanceof $?e:$,p=Object.create(a.prototype),w=new D(s||[]);return p._invoke=Ae(t,r,w),p}n.wrap=U;function R(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(s){return{type:"throw",arg:s}}}var T="suspendedStart",W="suspendedYield",x="executing",A="completed",E={};function $(){}function q(){}function O(){}var u={};d(u,l,function(){return this});var m=Object.getPrototypeOf,g=m&&m(m(Y([])));g&&g!==i&&f.call(g,l)&&(u=g);var F=O.prototype=$.prototype=Object.create(u);q.prototype=O,d(F,"constructor",O),d(O,"constructor",q),q.displayName=d(O,v,"GeneratorFunction");function S(t){["next","throw","return"].forEach(function(e){d(t,e,function(r){return this._invoke(e,r)})})}n.isGeneratorFunction=function(t){var e=typeof t=="function"&&t.constructor;return e?e===q||(e.displayName||e.name)==="GeneratorFunction":!1},n.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,O):(t.__proto__=O,d(t,v,"GeneratorFunction")),t.prototype=Object.create(F),t},n.awrap=function(t){return{__await:t}};function C(t,e){function r(p,w,y,j){var b=R(t[p],t,w);if(b.type==="throw")j(b.arg);else{var z=b.arg,_=z.value;return _&&typeof _=="object"&&f.call(_,"__await")?e.resolve(_.__await).then(function(k){r("next",k,y,j)},function(k){r("throw",k,y,j)}):e.resolve(_).then(function(k){z.value=k,y(z)},function(k){return r("throw",k,y,j)})}}var s;function a(p,w){function y(){return new e(function(j,b){r(p,w,j,b)})}return s=s?s.then(y,y):y()}this._invoke=a}S(C.prototype),d(C.prototype,h,function(){return this}),n.AsyncIterator=C,n.async=function(t,e,r,s,a){a===void 0&&(a=Promise);var p=new C(U(t,e,r,s),a);return n.isGeneratorFunction(e)?p:p.next().then(function(w){return w.done?w.value:p.next()})};function Ae(t,e,r){var s=T;return function(p,w){if(s===x)throw new Error("Generator is already running");if(s===A){if(p==="throw")throw w;return oe()}for(r.method=p,r.arg=w;;){var y=r.delegate;if(y){var j=ne(y,r);if(j){if(j===E)continue;return j}}if(r.method==="next")r.sent=r._sent=r.arg;else if(r.method==="throw"){if(s===T)throw s=A,r.arg;r.dispatchException(r.arg)}else r.method==="return"&&r.abrupt("return",r.arg);s=x;var b=R(t,e,r);if(b.type==="normal"){if(s=r.done?A:W,b.arg===E)continue;return{value:b.arg,done:r.done}}else b.type==="throw"&&(s=A,r.method="throw",r.arg=b.arg)}}}function ne(t,e){var r=t.iterator[e.method];if(r===o){if(e.delegate=null,e.method==="throw"){if(t.iterator.return&&(e.method="return",e.arg=o,ne(t,e),e.method==="throw"))return E;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return E}var s=R(r,t.iterator,e.arg);if(s.type==="throw")return e.method="throw",e.arg=s.arg,e.delegate=null,E;var a=s.arg;if(!a)return e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,E;if(a.done)e[t.resultName]=a.value,e.next=t.nextLoc,e.method!=="return"&&(e.method="next",e.arg=o);else return a;return e.delegate=null,E}S(F),d(F,v,"Generator"),d(F,l,function(){return this}),d(F,"toString",function(){return"[object Generator]"});function qe(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function M(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function D(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(qe,this),this.reset(!0)}n.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function s(){for(;e.length;){var a=e.pop();if(a in t)return s.value=a,s.done=!1,s}return s.done=!0,s}};function Y(t){if(t){var e=t[l];if(e)return e.call(t);if(typeof t.next=="function")return t;if(!isNaN(t.length)){var r=-1,s=function a(){for(;++r<t.length;)if(f.call(t,r))return a.value=t[r],a.done=!1,a;return a.value=o,a.done=!0,a};return s.next=s}}return{next:oe}}n.values=Y;function oe(){return{value:o,done:!0}}return D.prototype={constructor:D,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=o,this.done=!1,this.delegate=null,this.method="next",this.arg=o,this.tryEntries.forEach(M),!t)for(var e in this)e.charAt(0)==="t"&&f.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=o)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if(e.type==="throw")throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(j,b){return p.type="throw",p.arg=t,e.next=j,b&&(e.method="next",e.arg=o),!!b}for(var s=this.tryEntries.length-1;s>=0;--s){var a=this.tryEntries[s],p=a.completion;if(a.tryLoc==="root")return r("end");if(a.tryLoc<=this.prev){var w=f.call(a,"catchLoc"),y=f.call(a,"finallyLoc");if(w&&y){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(w){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else if(y){if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r];if(s.tryLoc<=this.prev&&f.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var a=s;break}}a&&(t==="break"||t==="continue")&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var p=a?a.completion:{};return p.type=t,p.arg=e,a?(this.method="next",this.next=a.finallyLoc,E):this.complete(p)},complete:function(t,e){if(t.type==="throw")throw t.arg;return t.type==="break"||t.type==="continue"?this.next=t.arg:t.type==="return"?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):t.type==="normal"&&e&&(this.next=e),E},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),M(r),E}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var s=r.completion;if(s.type==="throw"){var a=s.arg;M(r)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:Y(t),resultName:e,nextLoc:r},this.method==="next"&&(this.arg=o),E}},n}(typeof H=="object"?H.exports:{});try{regeneratorRuntime=V}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=V:Function("r","regeneratorRuntime = r")(V)}});var se=L((rt,ae)=>{ae.exports={defaultArgs:["./ffmpeg","-nostdin","-y"],baseOptions:{log:!1,logger:()=>{},progress:()=>{},corePath:""}}});var Z=L((nt,le)=>{var J=!1,fe=()=>{},Ce=n=>{J=n},Ue=n=>{fe=n},Re=(n,i)=>{fe({type:n,message:i}),J&&console.log(`[${n}] ${i}`)};le.exports={logging:J,setLogging:Ce,setCustomLogger:Ue,log:Re}});var pe=L((ot,ue)=>{var G=0,K=0,ce=n=>{let[i,f,o]=n.split(":");return parseFloat(i)*60*60+parseFloat(f)*60+parseFloat(o)};ue.exports=(n,i)=>{if(typeof n=="string")if(n.startsWith("  Duration")){let f=n.split(", ")[0].split(": ")[1],o=ce(f);i({duration:o,ratio:K}),(G===0||G>o)&&(G=o)}else if(n.startsWith("frame")||n.startsWith("size")){let f=n.split("time=")[1].split(" ")[0],o=ce(f);K=o/G,i({ratio:K,time:o})}else n.startsWith("video:")&&(i({ratio:1}),G=0)}});var de=L((it,he)=>{he.exports=(n,i)=>{let f=n._malloc(i.length*Uint32Array.BYTES_PER_ELEMENT);return i.forEach((o,c)=>{let l=n._malloc(o.length+1);n.writeAsciiToMemory(o,l),n.setValue(f+Uint32Array.BYTES_PER_ELEMENT*c,l,"i32")}),[i.length,f]}});var I=L((Q,me)=>{(function(n,i){typeof define=="function"&&define.amd?define(i):typeof Q=="object"?me.exports=i():n.resolveUrl=i()})(Q,function(){function n(){var i=arguments.length;if(i===0)throw new Error("resolveUrl requires at least one argument; got none.");var f=document.createElement("base");if(f.href=arguments[0],i===1)return f.href;var o=document.getElementsByTagName("head")[0];o.insertBefore(f,o.firstChild);for(var c=document.createElement("a"),l,h=1;h<i;h++)c.href=arguments[h],l=c.href,f.href=l;return o.removeChild(f),l}return n})});var X=L((at,Te)=>{Te.exports={name:"@ffmpeg/ffmpeg",version:"0.10.1",description:"FFmpeg WebAssembly version",main:"src/index.js",types:"src/index.d.ts",directories:{example:"examples"},scripts:{start:"node scripts/server.js",build:"rimraf dist && webpack --config scripts/webpack.config.prod.js",prepublishOnly:"npm run build",lint:"eslint src",wait:"rimraf dist && wait-on http://localhost:3000/dist/ffmpeg.dev.js",test:"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser:ffmpeg test:node:all","test:node":"node --experimental-wasm-threads --experimental-wasm-bulk-memory node_modules/.bin/_mocha --exit --bail --require ./scripts/test-helper.js","test:node:all":"npm run test:node -- ./tests/*.test.js","test:browser":"mocha-headless-chrome -a allow-file-access-from-files -a incognito -a no-sandbox -a disable-setuid-sandbox -a disable-logging -t 300000","test:browser:ffmpeg":"npm run test:browser -- -f ./tests/ffmpeg.test.html"},browser:{"./src/node/index.js":"./src/browser/index.js"},repository:{type:"git",url:"git+https://github.com/ffmpegwasm/ffmpeg.wasm.git"},keywords:["ffmpeg","WebAssembly","video"],author:"Jerome Wu <jeromewus@gmail.com>",license:"MIT",bugs:{url:"https://github.com/ffmpegwasm/ffmpeg.wasm/issues"},engines:{node:">=12.16.1"},homepage:"https://github.com/ffmpegwasm/ffmpeg.wasm#readme",dependencies:{"is-url":"^1.2.4","node-fetch":"^2.6.1","regenerator-runtime":"^0.13.7","resolve-url":"^0.2.1"},devDependencies:{"@babel/core":"^7.12.3","@babel/preset-env":"^7.12.1","@ffmpeg/core":"^0.10.0","@types/emscripten":"^1.39.4","babel-loader":"^8.1.0",chai:"^4.2.0",cors:"^2.8.5",eslint:"^7.12.1","eslint-config-airbnb-base":"^14.1.0","eslint-plugin-import":"^2.22.1",express:"^4.17.1",mocha:"^8.2.1","mocha-headless-chrome":"^2.0.3","npm-run-all":"^4.1.5","wait-on":"^5.3.0",webpack:"^5.3.2","webpack-cli":"^4.1.0","webpack-dev-middleware":"^4.0.0"}}});var ve=L((ft,ge)=>{var st=I(),{devDependencies:$e}=X();ge.exports={corePath:`https://unpkg.com/@ffmpeg/core@${$e["@ffmpeg/core"].substring(1)}/dist/ffmpeg-core.js`}});var ye=L((lt,we)=>{var _e=I(),{log:B}=Z(),ee=async(n,i)=>{B("info",`fetch ${n}`);let f=await(await fetch(n)).arrayBuffer();B("info",`${n} file size = ${f.byteLength} bytes`);let o=new Blob([f],{type:i}),c=URL.createObjectURL(o);return B("info",`${n} blob URL = ${c}`),c};we.exports=async({corePath:n})=>{if(typeof n!="string")throw Error("corePath should be a string!");let i=_e(n),f=await ee(i,"application/javascript"),o=await ee(i.replace("ffmpeg-core.js","ffmpeg-core.wasm"),"application/wasm"),c=await ee(i.replace("ffmpeg-core.js","ffmpeg-core.worker.js"),"application/javascript");return typeof createFFmpegCore>"u"?new Promise(l=>{let h=document.createElement("script"),v=()=>{h.removeEventListener("load",v),B("info","ffmpeg-core.js script loaded"),l({createFFmpegCore,corePath:f,wasmPath:o,workerPath:c})};h.src=f,h.type="text/javascript",h.addEventListener("load",v),document.getElementsByTagName("head")[0].appendChild(h)}):(B("info","ffmpeg-core.js script is loaded already"),Promise.resolve({createFFmpegCore,corePath:f,wasmPath:o,workerPath:c}))}});var Ee=L((ct,be)=>{var Ge=I(),Be=n=>new Promise((i,f)=>{let o=new FileReader;o.onload=()=>{i(o.result)},o.onerror=({target:{error:{code:c}}})=>{f(Error(`File could not be read! Code=${c}`))},o.readAsArrayBuffer(n)});be.exports=async n=>{let i=n;return typeof n>"u"?new Uint8Array:(typeof n=="string"?/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(n)?i=atob(n.split(",")[1]).split("").map(f=>f.charCodeAt(0)):i=await(await fetch(Ge(n))).arrayBuffer():(n instanceof File||n instanceof Blob)&&(i=await Be(n)),new Uint8Array(i))}});var te=L((ut,Le)=>{var Ne=ve(),xe=ye(),Ie=Ee();Le.exports={defaultOptions:Ne,getCreateFFmpegCore:xe,fetchFile:Ie}});var Oe=L((pt,Se)=>{var{defaultArgs:We,baseOptions:Me}=se(),{setLogging:Fe,setCustomLogger:je,log:P}=Z(),De=pe(),Ye=de(),{defaultOptions:ze,getCreateFFmpegCore:Ve}=te(),{version:He}=X(),re=Error("ffmpeg.wasm is not ready, make sure you have completed load().");Se.exports=(n={})=>{let{log:i,logger:f,progress:o,...c}={...Me,...ze,...n},l=null,h=null,v=null,d=!1,U=o,R=u=>{u==="FFMPEG_END"&&v!==null&&(v(),v=null,d=!1)},T=({type:u,message:m})=>{P(u,m),De(m,U),R(m)},W=async()=>{if(P("info","load ffmpeg-core"),l===null){P("info","loading ffmpeg-core");let{createFFmpegCore:u,corePath:m,workerPath:g,wasmPath:F}=await Ve(c);l=await u({mainScriptUrlOrBlob:m,printErr:S=>T({type:"fferr",message:S}),print:S=>T({type:"ffout",message:S}),locateFile:(S,C)=>{if(typeof window<"u"){if(typeof F<"u"&&S.endsWith("ffmpeg-core.wasm"))return F;if(typeof g<"u"&&S.endsWith("ffmpeg-core.worker.js"))return g}return C+S}}),h=l.cwrap("proxy_main","number",["number","number"]),P("info","ffmpeg-core loaded")}else throw Error("ffmpeg.wasm was loaded, you should not load it again, use ffmpeg.isLoaded() to check next time.")},x=()=>l!==null,A=(...u)=>{if(P("info",`run ffmpeg command: ${u.join(" ")}`),l===null)throw re;if(d)throw Error("ffmpeg.wasm can only run one command at a time");return d=!0,new Promise(m=>{let g=[...We,...u].filter(F=>F.length!==0);v=m,h(...Ye(l,g))})},E=(u,...m)=>{if(P("info",`run FS.${u} ${m.map(g=>typeof g=="string"?g:`<${g.length} bytes binary file>`).join(" ")}`),l===null)throw re;{let g=null;try{g=l.FS[u](...m)}catch{throw Error(u==="readdir"?`ffmpeg.FS('readdir', '${m[0]}') error. Check if the path exists, ex: ffmpeg.FS('readdir', '/')`:u==="readFile"?`ffmpeg.FS('readFile', '${m[0]}') error. Check if the path exists`:"Oops, something went wrong in FS operation.")}return g}},$=()=>{if(l===null)throw re;d=!1,l.exit(1),l=null,h=null,v=null},q=u=>{U=u},O=u=>{je(u)};return Fe(i),je(f),P("info",`use ffmpeg.wasm v${He}`),{setProgress:q,setLogger:O,setLogging:Fe,load:W,isLoaded:x,run:A,exit:$,FS:E}}});var Pe=L((ht,ke)=>{ie();var Je=Oe(),{fetchFile:Ze}=te();ke.exports={createFFmpeg:Je,fetchFile:Ze}});var{createFFmpeg:Ke}=Pe(),N=Ke({log:!0}),Qe=async({target:{files:n}})=>{console.log(n),N.isLoaded()||await N.load();for(let i=1;i<=n.length;i++){let f=n[i-1],o=f.name,c=document.createElement("a");c.innerText=`(${i}/${n.length}) Loading... ${o.replace(o.substr(o.lastIndexOf(".")),"")}.mp3`,document.body.appendChild(c),document.body.appendChild(document.createElement("br"));let l=await f.arrayBuffer(),h=new Uint8Array(l);N.FS("writeFile",o,h),await N.run("-i",o,"test.mp3");let v=N.FS("readFile","test.mp3");c.href=URL.createObjectURL(new Blob([v.buffer],{type:"audio/mpeg"})),c.download=o.replace(o.substr(o.lastIndexOf(".")),"")+".mp3",c.innerText=o.replace(o.substr(o.lastIndexOf(".")),"")+".mp3"}},Xe=document.getElementById("uploader");Xe.addEventListener("change",Qe);})();
